# 기록 입력 화면 요구사항 (v1)

## 1. 대상 사용자
- 로그인한 회원 중 특정 미션에 참여 중인 사용자.

## 2. 입력 필드
| 필드 | 타입 | 필수 | 검증 규칙 |
| --- | --- | --- | --- |
| 미션 선택 | select | Y | 참여 중 미션만 노출, 미선택 시 제출 불가 |
| 활동 종료 시각 | datetime-local | Y | 미래 시간 입력 불가 |
| 거리(km) | number (자동 채움) | Y | OCR 결과로 기본 채움, 0 초과, 소수점 2자리까지 허용 |
| 시간(초) | number (자동 채움) | Y | OCR 결과로 기본 채움, 0 초과, 정수 |
| 페이스(초/킬로) | number (자동 계산) | Y | 거리·시간으로 자동 계산, 수정 허용, 0 초과 |
| 공개 설정 | toggle | Y | 기본값 `public`, `private` 선택 시 안내 문구 노출 |
| 메모 | textarea | N | 최대 500자 |
| 이미지 업로드 | file | Y | JPG/PNG 5MB 이하, 업로드 시 썸네일 및 OCR 진행 |

## 3. 제출 로직
1. 이미지 업로드 → Supabase Storage 임시 버킷 저장.
2. 업로드 완료 트리거로 Edge Function 호출 → OCR API 요청 → 거리/시간/날짜 추출.
3. OCR 파싱 결과를 폼에 주입하고 사용자가 수동 수정 가능하도록 입력 값 활성화.
4. 사용자 검증 후 `확인` 클릭 → Supabase `records` 테이블에 `insert`.
5. 성공 시 대시보드로 리다이렉트 + 성공 토스트.

## 4. 공개 설정 안내 문구
- `public`: “크루원과 통계에 모두 반영됩니다.”
- `private`: “본인만 열람 가능하며 전체 통계에서 제외됩니다.”

## 5. OCR 예외 처리
- 추출 실패: “기록을 읽을 수 없습니다. 값을 직접 입력해주세요.” 메시지, 입력 필드 수동 편집 활성화.
- Edge Function 오류: 재시도 버튼 제공, 3회 실패 시 수동 입력 모드 유지.
- 추출된 값과 입력 값 차이가 클 경우 경고 토스트 노출.

## 6. 에러 처리
- 업로드 실패: “이미지 업로드에 실패했습니다. 다시 시도해주세요.”
- RLS 거부: 세션 재요청 후 실패 시 로그인 페이지로 이동.
- 네트워크 오류: 재시도 버튼/링크 제공.

## 7. 확장 고려 사항
- 다중 이미지 지원 여부 추후 검토.
- 추출 지표 확장(심박수, 고도 등)을 위한 필드 placeholder 확보.
- OCR 신뢰도 점수 저장 후 관리자 검토 흐름 연계 예정.
