# 범용 댓글 시스템 통합 테스트 체크리스트

## 테스트 환경
- 로컬 개발 서버: http://localhost:3000
- 테스트 일시: 2025-10-12
- 테스트 브랜치: dev

## 1. 데이터베이스 마이그레이션 확인

### 1.1 테이블 존재 확인
- [ ] `comments` 테이블 존재 확인
- [ ] `entity_likes` 테이블 존재 확인
- [ ] `comment_likes` 테이블 존재 확인
- [ ] `entity_type` enum 존재 확인

### 1.2 데이터 마이그레이션 확인
- [ ] 기존 `record_comments` 데이터가 `comments` 테이블로 이동됨
- [ ] 기존 댓글의 entity_type이 'record'로 설정됨
- [ ] 기존 댓글의 profile 정보 유지됨

### 1.3 RLS 정책 확인
- [ ] comments 테이블 SELECT 정책 작동
- [ ] comments 테이블 INSERT 정책 작동 (인증된 사용자만)
- [ ] comments 테이블 UPDATE 정책 작동 (본인만)
- [ ] comments 테이블 DELETE 정책 작동 (본인만)

## 2. API 엔드포인트 테스트

### 2.1 GET /api/comments
- [ ] entityType과 entityId로 댓글 조회
- [ ] 프로필 정보 포함 확인
- [ ] 로그인한 사용자의 좋아요 상태 포함
- [ ] created_at 기준 내림차순 정렬

### 2.2 POST /api/comments
- [ ] 댓글 작성 성공
- [ ] mentions 배열 저장
- [ ] 비로그인 시 401 에러
- [ ] 내용 없으면 400 에러
- [ ] 1000자 초과 시 에러

### 2.3 PATCH /api/comments/[commentId]
- [ ] 본인 댓글 수정 성공
- [ ] 타인 댓글 수정 시 권한 에러
- [ ] 비로그인 시 401 에러

### 2.4 DELETE /api/comments/[commentId]
- [ ] 본인 댓글 삭제 성공
- [ ] 타인 댓글 삭제 시 권한 에러
- [ ] 비로그인 시 401 에러

### 2.5 POST /api/comments/[commentId]/like
- [ ] 댓글 좋아요 성공
- [ ] 중복 좋아요 시 400 에러
- [ ] likes_count 자동 증가

### 2.6 DELETE /api/comments/[commentId]/like
- [ ] 댓글 좋아요 취소 성공
- [ ] likes_count 자동 감소

### 2.7 GET /api/users/search
- [ ] 쿼리로 사용자 검색 성공
- [ ] username, full_name, display_name 모두 검색
- [ ] 대소문자 구분 없이 검색
- [ ] limit 파라미터 작동

## 3. UI 컴포넌트 테스트

### 3.1 CommentsSection 컴포넌트
- [ ] 컴포넌트 렌더링 성공
- [ ] 댓글 목록 로딩
- [ ] 빈 댓글 상태 메시지 표시
- [ ] 로그인 안 하면 입력폼 숨김

### 3.2 CommentInput 컴포넌트
- [ ] 텍스트 입력 정상 작동
- [ ] 글자 수 카운트 표시 (1000자 제한)
- [ ] Ctrl+Enter로 전송
- [ ] 댓글 작성 버튼 클릭 시 전송
- [ ] 빈 내용 전송 방지

### 3.3 @ 멘션 자동완성
- [ ] @ 입력 시 자동완성 드롭다운 표시
- [ ] 2글자 이상 입력 시 사용자 검색
- [ ] 아바타와 사용자 정보 표시
- [ ] 방향키(↑↓)로 선택 가능
- [ ] Enter로 멘션 삽입
- [ ] Esc로 드롭다운 닫기
- [ ] 클릭으로 멘션 삽입
- [ ] 멘션 후 자동으로 공백 추가
- [ ] 멘션된 사용자 ID mentions 배열에 저장

### 3.4 CommentItem 컴포넌트
- [ ] 댓글 내용 표시
- [ ] 사용자 아바타 표시
- [ ] 상대 시간 표시 (방금 전, N분 전, ...)
- [ ] 수정됨 표시 (updated_at ≠ created_at)
- [ ] 멘션 하이라이트 (@username 파란색)

### 3.5 댓글 좋아요 기능
- [ ] 하트 아이콘 클릭 시 좋아요
- [ ] 하트 아이콘 빨간색으로 채워짐
- [ ] 좋아요 카운트 실시간 업데이트
- [ ] 재클릭 시 좋아요 취소
- [ ] 비로그인 시 버튼 비활성화

### 3.6 댓글 수정/삭제
- [ ] 본인 댓글만 메뉴 버튼 표시
- [ ] hover 시 메뉴 버튼 표시
- [ ] 수정 버튼 클릭 시 편집 모드
- [ ] 편집 모드에서 textarea 표시
- [ ] 저장 버튼으로 수정 완료
- [ ] 취소 버튼으로 수정 취소
- [ ] 삭제 버튼 클릭 시 확인 다이얼로그
- [ ] 삭제 확인 시 댓글 제거

## 4. 기록 페이지 통합 테스트

### 4.1 페이지 렌더링
- [ ] 기록 상세 페이지 정상 로딩
- [ ] 새 댓글 섹션 표시
- [ ] 기존 댓글 마이그레이션 확인
- [ ] 댓글 카운트 정확성

### 4.2 댓글 CRUD
- [ ] 기록에 댓글 작성
- [ ] 작성한 댓글 즉시 표시
- [ ] 댓글 수정 가능
- [ ] 댓글 삭제 가능
- [ ] 페이지 새로고침 후에도 댓글 유지

### 4.3 멘션 기능
- [ ] 기록 댓글에서 @ 멘션 작동
- [ ] 멘션된 사용자 하이라이트
- [ ] 멘션 알림 생성 확인

### 4.4 댓글 좋아요
- [ ] 기록 댓글 좋아요 작동
- [ ] 좋아요 카운트 업데이트
- [ ] 좋아요 취소 작동

## 5. 알림 시스템 테스트

### 5.1 댓글 알림
- [ ] 기록 댓글 작성 시 기록 작성자에게 알림
- [ ] 알림 타입: 'comment_created'
- [ ] 알림 내용에 댓글 미리보기
- [ ] 알림 링크로 이동 가능

### 5.2 댓글 좋아요 알림
- [ ] 댓글 좋아요 시 댓글 작성자에게 알림
- [ ] 알림 타입: 'comment_liked'
- [ ] 자기 댓글 좋아요 시 알림 없음

### 5.3 멘션 알림
- [ ] 멘션 시 해당 사용자에게 알림
- [ ] 알림 타입: 'mention'
- [ ] 멘션한 사람 이름 표시
- [ ] 댓글 미리보기 50자
- [ ] 여러 명 멘션 시 각각 알림

### 5.4 알림 중복 방지
- [ ] 자기 자신 멘션 시 알림 없음
- [ ] 동일 댓글/좋아요 중복 알림 없음

## 6. 성능 및 UX 테스트

### 6.1 로딩 성능
- [ ] 댓글 목록 빠르게 로딩
- [ ] 이미지/아바타 lazy loading
- [ ] API 응답 시간 2초 이내

### 6.2 사용자 경험
- [ ] 댓글 작성 후 입력창 초기화
- [ ] 에러 메시지 사용자 친화적
- [ ] 로딩 중 버튼 비활성화
- [ ] 낙관적 업데이트 (optimistic update)

### 6.3 반응형 디자인
- [ ] 모바일 화면에서 정상 작동
- [ ] 멘션 드롭다운 모바일 대응
- [ ] 터치 인터랙션 정상 작동

## 7. 에러 처리 테스트

### 7.1 네트워크 에러
- [ ] API 실패 시 에러 메시지
- [ ] 재시도 가능

### 7.2 권한 에러
- [ ] 비로그인 시 적절한 안내
- [ ] 권한 없는 작업 시 에러 메시지

### 7.3 유효성 검증
- [ ] 빈 댓글 방지
- [ ] 1000자 초과 방지
- [ ] 특수문자 처리

## 8. 확장성 테스트

### 8.1 다른 엔티티 타입 준비
- [ ] entity_type enum에 다른 타입 포함
- [ ] CommentsSection 다른 타입에서 사용 가능
- [ ] 알림 링크 entity_type에 따라 생성

## 테스트 결과 요약

### 성공한 테스트
-

### 실패한 테스트
-

### 발견된 버그
-

### 개선 사항
-

## 다음 단계
1. [ ] 모든 테스트 통과 확인
2. [ ] 발견된 버그 수정
3. [ ] 코드 리뷰
4. [ ] main 브랜치 머지
